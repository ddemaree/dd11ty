---
import BaseHead from '@components/BaseHead.astro';
import SiteHeader from '@components/SiteHeader.astro';
import PostHeader from '@components/PostHeader.astro';
import Footer from '@components/Footer.astro';
import { getAllPosts, getSinglePost } from '@lib/wordpress';
import SiteLayout from '@components/SiteLayout.astro';
import sanitizeHtml from '@lib/sanitizeHtml';

const { slug } = Astro.params;
const { error, post } = await getSinglePost(slug);

if(!post) {
	return new Response("Post not found", {
		status: 404,
		statusText: error
	})
}

const { posts } = await getAllPosts();

const { title, content, excerpt, date, featuredImage } = post;

const cleanContent = sanitizeHtml(content);

---
<html lang="en">
	<head>
    <BaseHead title={title} description={excerpt} />
	</head>
	<body>
		<SiteLayout section="blog">
			<article class="content">
				<PostHeader title={title} subtitle={excerpt} date={date} image={featuredImage} />
				<main class="mt-8 prose prose-lg prose-grid font-serif prose-figcaption:font-sans">
					<Fragment set:html={cleanContent} />
				</main>
			</article>
		</SiteLayout>
	</body>
</html>
